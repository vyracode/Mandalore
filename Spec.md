# Mandalore
Mandalore is a *companion webapp* for english speakers learning the mandarin language.
Users take lessons from other learning resources, and input their wordlists and into Mandalore for practice.
While the other resources continue to teach new material, Mandalore works to help users retain the material they have already learned.

Wordlists are imported as json, pasted into the app, and take the form of:
```json
[
    {
        "word": "word (hanzi)",
        "pinyin": "pinyin (with tones)",
        "definition": "definition"
    }
]
```
Users are advised to convert whatever form of wordlist they have (eg: App Screenshots, Spreadsheets, etc) using an LLM such as ChatGPT.

Mandalore ships with a default collection of assets, (Audio pronunciations, and Images to accompany definitions), which are automatically matched to words in imported wordlists.

## Principles
- We assume users will want to:
    - Speak Mandarin
    - Understand Spoken Mandarin
    - Read Hanzi
    - Write Hanzi using a Pinyin keyboard.
- This means:
    - Handwriting Hanzi is irelevent to most learners, and is considered out-of-scope.
    - Pinyin is tought exclusively as a means of operating a Pinyin keyboard to write Hanzi, meaning tones are not considered part of the Pinyin skillset.
    - Tones are vitally important to Mandarin pronunciation, and are considered part of the pronunciation skillset.
        - Which means we teach the tones you say, not the tones that are formally written. (We automatically handle 3rd tone sandhi in the background, and only teach the result)
- As much as possible, we aim to teach mappings from Mandarin words -> Concepts, not mappings from Mandarin words -> English words. (Though this is challenging)

# Playgrounds:
Playgrounds are Mandalore's tabs of distinct practice types.

The main playgrounds are:
- Multimodal Flashcards
- Translation Practice
- Settings (Not really a playground, but it's tabbed like one)

## Multimodal Flashcards
Multimodal Flashcards conceptualize of words across 4 modalities:
- Hanzi (Recognition only, no writing)
- Pronunciation (Including Tone)
- Pinyin Spelling (Excluding Tones)
- Meaning

A flashcard for a given word randomly selects one of these modalities to display (The *Front*), and the user must provide the correct responses for each of the other modalities (The *Back*).
Some of these modalities are graded (Tone, Pinyin Spelling), and others rely on the user to self-grade (Full Pronunciation, Meaning).

The flashcards utilize FSRS-6 for Spacing. For the purposes of FSRS-6, we consider each of the possible fronts for a given word as distinct cards.
For the sake of simplicity, we combine the FSRS-6 grades down to a binary, by only using "Good" (Renamed as "Right") and "Again" (Renamed as "Wrong"), disusing "Easy" and "Hard" entirely.

For self-grade modalities, we display "Right" and "Wrong" buttons with the reveal of the correct answer.

### Modality Support
- Hanzi: 
    - When Hanzi is Front: Hanzi is provided, user is expected to recognize.
    - When another mode is Front: Multiple-choice Hanzi are shown, user is expected to select the correct one. 
        - These choices are generated by a Pinyin keyboard engine, displaying the most likely choices based on the correct Pinyin spelling, or an incomplete spelling (To emulate the multiple choices the user would get when typing the word with a Pinyin keyboard)
        - When the user clicks "Reveal", the correct Hanzi is shown.
- Pronunciation:
    - When Front: Pronunciation is provided, as audio, user is expected to recognize.
    - When Back: User types the tones as numbers (neutral tone is 5), graded (pass or fail). User speaks the word outloud, self-graded.
        - Eg: 欢迎 (Huānyíng) = 12, 为什么 (wèishénme) = 425
        - When the user clicks "Reveal", the correct pronunciation is provided as audio.
- Pinyin Spelling:
    - When Front: Pinyin Spelling is provided (with tones), user is expected to recognize.
    - When Back: User types the pinyin spelling (without tones), graded (pass or fail).
        - When the user clicks "Reveal", the correct pinyin spelling is shown.
    - Notes: 
        - Because the spelling is provided with tones (Mandarin's homophones make this necessary), tone input is not included on the back, but self-graded pronunciation with example audio is still provided.
- Meaning:
    - When Front: English meaning is provided, user is expected to recall the correct Mandarin word.
    - When Back: Entirely self-graded, with the reveal button providing the correct answer.
- Note: If the back of the card includes both Hanzi and Pinyin Spelling, the multiple choice Hanzi and Pinyin Spelling textbox are replaced by a single *Hanzi Textbox*. This will test both modalities, as the user is assumed to use a Pinyin keyboard to write the Hanzi, which implicitly tests the Pinyin Spelling, and Hanzi multiple choice recognition. If the user is unable to do this, the user can toggle to go back to the seperate inputs.

Assets are located by removing whitespace from a Hanzi word, sanitizing it, then checking for a file with that name and the extension for that type of asset, in the "word_assets" folder.

## Translation Practice
Translation Practice allows users to translate sentences from English to Mandarin, and vice versa.

First, the known words are provided to the Gemini API, and the API returns a practice sentence in both languages, built exclusively of known words.
The user is then prompted to translate the sentence from English to Mandarin, or vice versa.
The resulting string (which may contain Hanzi, Pinyin, and/or English) is then sent back to the Gemini API, which provides rich per-word feedback on the translation.
In the case that the user provides Pinyin, tone is ignored.

Gemini's sentences are cached permanently, so they can be used again later, however new sentences are always prefered to cached sentences.

Sentances are returned from the Gemini API in the form of:
```json
{
    "mandarin": "Mandarin sentence (Hanzi)"
    "english": "English sentence",
}
```

Feedback is returned from the Gemini API in the form of:
```json
{
    "overview": "Overview of the translation",
    "words": [
        {
            "user_word": "lianbāo",
            "correctness": "Incorrect",
            "correct_word": "面包"
            "correct_pinyin": "miànbāo"
            "notes": "Incorrect spelling. The correct word for bread is miànbāo (面包), with an 'm' instead of an 'l'."
        }
    ]
}
```

## Settings
Consider this a stub for now, apart from one thing:
- Import Wordlist (Accessed through Settings)
    - Simply a big textbox for pasting a json wordlist, and an "Import" button.
    - Clicking the Import button will provide an imformative and actionable error message to the user if something is wrong.

# Tech Stack

## Frontend
- HTML5
- CSS3
- Vanilla JS

## Backend
- dongyuwei/web-pinyin-ime (for PinyinKeyboard-like Hanzi multiple choice)
- Gemini API (for Translation Practice) (Generous free tier, as long as they can train on your inputs, but that's fine)

# Appearance
The webapp must be beautiful. A true pleasure to use. Make sure of this.

Bottom bar for switching between playgrounds.
Flashcards: Displayed as a vertical stack of modalities, with the front highlighted at the top of the screen, with the back modalities cascading below it, each with their own label, gradable input field (textbox, multiple choice, etc. If applicable), and a "Reveal" button to show the correct answer.
Sentance Translation: "A" screen is a simple "Translate the following into [Language]" screen. "B" screen displays overview, and displays the correct translation, with each word color-coded based on correctness (Correct, incorrect spelling, wrong word choice, missing word, extra word). The user can click on a word to see the details of the feedback for that word.

