<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mandalore</title>

    <meta name="description" content="A companion web-app for English speakers learning Mandarin" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Inter:wght@400;700&family=JetBrains+Mono:wght@500;600&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app" id="app">

        <main>
            <div class="screen-inner">

                <!-- FLASHCARDS -->
                <div id="screen-flash" class="flash-layout">
                    <div class="card-stack">
                        <div class="front-card" id="frontCard">
                            <div class="front-top">
                                <div class="badge" id="frontBadge"><span class="dot" aria-hidden="true"></span><span
                                        id="frontLabel">Hanzi</span></div>
                                <button class="btn primary btn-next-header" id="btnFabNext" type="button" aria-label="Skip card">
                                    Skip <span aria-hidden="true">‚Üí</span>
                                </button>
                            </div>

                            <div class="front-body" id="frontBody">
                                <div class="front-hanzi" id="frontText">Ê¨¢Ëøé</div>
                            </div>

                            <div class="front-foot">
                                <span class="spark" aria-hidden="true"></span><span id="frontHint">Recognize the
                                    word</span>
                            </div>
                        </div>

                        <div class="mod" id="modStack">

                            <!-- Meaning (self-grade after check) -->
                            <div class="mod-card" data-mod="meaning" data-state="input" id="modMeaning">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--orange); box-shadow: 0 0 0 3px rgba(255,176,32,.14)"
                                            aria-hidden="true"></span> Meaning</div>
                                    <div class="mod-actions">
                                        <button class="btn mod-input" data-action="checkMeaning" type="button">Check</button>
                                        <div class="checked-result mod-finished-result" data-role="meaningHeaderResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="meaningHeaderMsg"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mod-body mod-checked">
                                    <div class="checked-row">
                                        <div class="checked-answer" data-role="meaningAnswer"></div>
                                        <div class="checked-grade" data-role="meaningSelf">
                                            <button class="btn-grade good" data-action="selfRight" type="button" aria-label="Right">‚úì</button>
                                            <button class="btn-grade bad" data-action="selfWrong" type="button" aria-label="Wrong">‚úó</button>
                                        </div>
                                    </div>
                                    <div class="checked-result" data-role="meaningResult">
                                        <span class="r-dot" aria-hidden="true"></span>
                                        <span data-role="meaningMsg"></span>
                                    </div>
                                </div>
                                <div class="mod-finished" data-role="meaningFinished">
                                    <div class="finished-answer" data-role="meaningFinishedAnswer"></div>
                                </div>
                            </div>

                            <!-- Hanzi Typing (combined Hanzi + Pinyin test) -->
                            <div class="mod-card" data-mod="hanziTyping" data-state="input" id="modHanziTyping">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--cyan); box-shadow: 0 0 0 3px rgba(40,216,255,.14)"
                                            aria-hidden="true"></span> Hanzi Typing</div>
                                    <div class="mod-actions">
                                        <button class="btn ghost btn-separate" data-action="separateInputs" type="button">Separate</button>
                                        <div class="checked-result mod-finished-result" data-role="hanziTypingHeaderResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="hanziTypingHeaderMsg"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mod-body">
                                    <div class="row mod-input">
                                        <input class="field" inputmode="text" type="text" enterkeyhint="go"
                                            autocapitalize="none" autocorrect="off" placeholder="type hanzi" 
                                            data-input="hanziTyping" aria-label="Hanzi input" lang="zh" />
                                        <button class="btn" data-action="checkHanziTyping" id="btnCheckHanziTyping" type="button">Check</button>
                                    </div>
                                    <div class="hint-text" id="hanziTypingHint" style="display: none; margin-top: 8px; font-size: 12px; color: rgba(255,255,255,.6);"></div>
                                    <div class="checked-row mod-checked">
                                        <div class="checked-result" data-role="hanziTypingResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="hanziTypingMsg"></span>
                                        </div>
                                        <div class="checked-answer" data-role="hanziTypingAnswer"></div>
                                        <button class="btn" data-action="coverHanziTyping" data-role="hanziTypingCover" type="button">Cover</button>
                                    </div>
                                    <div class="mod-finished" data-role="hanziTypingFinished">
                                        <div class="finished-answer" data-role="hanziTypingFinishedAnswer"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hanzi (multiple choice) -->
                            <div class="mod-card" data-mod="hanzi" data-state="input" id="modHanzi">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--cyan); box-shadow: 0 0 0 3px rgba(40,216,255,.14)"
                                            aria-hidden="true"></span> Hanzi</div>
                                    <div class="mod-actions">
                                        <div class="checked-result compact mod-finished-result" data-role="hanziResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="hanziMsg"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mod-body">
                                    <div class="choices" role="group" aria-label="Hanzi choices">
                                        <button class="choice" data-choice type="button">Ê¨¢Ëøé</button>
                                        <button class="choice" data-choice type="button">ÁéØÂ¢É</button>
                                        <button class="choice" data-choice type="button">ÁºìÂ∫î</button>
                                        <button class="choice" data-choice type="button">Ê¨¢È•Æ</button>
                                        <button class="choice" data-choice type="button">Ê¨¢ËøéÂêß</button>
                                        <button class="choice" data-choice type="button">Ê¨¢ÂΩ±</button>
                                    </div>
                                    <div class="mod-finished" data-role="hanziFinished">
                                        <div class="finished-answer" data-role="hanziFinishedAnswer"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pinyin spelling (graded) -->
                            <div class="mod-card" data-mod="pinyin" data-state="input" id="modPinyin">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--purple); box-shadow: 0 0 0 3px rgba(122,92,255,.14)"
                                            aria-hidden="true"></span> Spelling</div>
                                    <div class="mod-actions">
                                        <div class="checked-result mod-finished-result" data-role="pinyinHeaderResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="pinyinHeaderMsg"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mod-body">
                                    <div class="row mod-input">
                                        <input class="field" inputmode="latin" type="text" enterkeyhint="go"
                                            autocapitalize="none" autocorrect="off" placeholder="pinyin (no tones)" 
                                            data-input="pinyin" aria-label="Pinyin spelling" />
                                        <button class="btn" data-action="checkPinyin" id="btnCheckPinyin" type="button">Check</button>
                                    </div>
                                    <div class="hint-text" id="pinyinHint" style="display: none; margin-top: 8px; font-size: 12px; color: rgba(255,255,255,.6);"></div>
                                    <div class="checked-row mod-checked">
                                        <div class="checked-result" data-role="pinyinResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="pinyinMsg"></span>
                                        </div>
                                        <div class="checked-answer" data-role="pinyinAnswer"></div>
                                        <button class="btn" data-action="coverPinyin" data-role="pinyinCover" type="button">Cover</button>
                                    </div>
                                    <div class="mod-finished" data-role="pinyinFinished">
                                        <div class="finished-answer" data-role="pinyinFinishedAnswer"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pronunciation -->
                            <div class="mod-card" data-mod="pronunciation" data-state="input" id="modPron">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini" aria-hidden="true"></span> Pronunciation</div>
                                    <div class="mod-actions"></div>
                                </div>

                                <div class="mod-body pron">
                                    <div class="pron-block pron-tone" data-pron-state="input">
                                        <div class="pron-head">
                                            <div class="pron-label">Tones</div>
                                            <div class="checked-result pron-finished-result" data-role="toneHeaderResult">
                                                <span class="r-dot" aria-hidden="true"></span>
                                                <span data-role="toneHeaderMsg"></span>
                                            </div>
                                        </div>
                                        <div class="row mod-input" style="justify-content:space-between">
                                            <input class="field" inputmode="numeric" type="tel" enterkeyhint="go"
                                                pattern="[0-9]*" autocorrect="off" placeholder="tone numbers" 
                                                data-input="tone" aria-label="Tone numbers" />
                                            <button class="btn" data-action="checkTone" type="button">Check</button>
                                        </div>
                                        <div class="checked-row mod-checked">
                                            <div class="checked-result" data-role="toneResult">
                                                <span class="r-dot" aria-hidden="true"></span>
                                                <span data-role="toneMsg"></span>
                                            </div>
                                            <div class="checked-answer" data-role="toneAnswer"></div>
                                        </div>
                                        <div class="mod-finished" data-role="toneFinished">
                                            <div class="finished-answer" data-role="toneFinishedAnswer"></div>
                                        </div>
                                    </div>

                                    <div class="pron-divider" aria-hidden="true"></div>

                                    <div class="pron-block pron-speak" data-pron-state="input">
                                        <div class="pron-head">
                                            <div class="pron-label">Speaking</div>
                                            <div class="checked-result pron-finished-result" data-role="speechHeaderResult">
                                                <span class="r-dot" aria-hidden="true"></span>
                                                <span data-role="speechHeaderMsg"></span>
                                            </div>
                                        </div>
                                        <div class="row mod-input" style="justify-content:space-between">
                                            <div class="chip" style="background: rgba(0,0,0,.12)"><span class="mini"
                                                    style="background: var(--cyan); box-shadow: 0 0 0 3px rgba(40,216,255,.14)"
                                                    aria-hidden="true"></span> Say it out loud</div>
                                            <button class="btn" data-action="checkSpeech" type="button">Check</button>
                                        </div>
                                        <div class="checked-row mod-checked">
                                            <div class="checked-audio" data-role="speechAnswer"></div>
                                            <div class="checked-grade" data-role="speechSelf">
                                                <button class="btn-grade good" data-action="selfRight" type="button" aria-label="Right">‚úì</button>
                                                <button class="btn-grade bad" data-action="selfWrong" type="button" aria-label="Wrong">‚úó</button>
                                            </div>
                                        </div>
                                        <div class="checked-result" data-role="speechResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="speechMsg"></span>
                                        </div>
                                        <div class="mod-finished" data-role="speechFinished"></div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- Next button (appears when all modalities are finished) -->
                        <button class="btn primary btn-next-bottom" id="btnNextBottom" type="button" style="display: none;">
                            Next <span aria-hidden="true">‚Üí</span>
                        </button>

                    </div>
                </div>

                <!-- TRANSLATION -->
                <div id="screen-translate" class="translate-layout hide">
                    <div class="translate-card">
                        <div id="translateContainer" style="display:flex; flex-direction:column; gap:12px; min-height:0;">
                            <div class="prompt" id="translatePromptBox">
                                <div class="label" style="justify-content:space-between; width:100%">
                                    <span style="display:flex; align-items:center; gap:8px">
                                        <span class="k" aria-hidden="true"></span>
                                        <span id="translateLabel">Translate into ‰∏≠Êñá</span>
                                    </span>
                                    <div style="display:flex; gap:8px; align-items:center;">
                                        <button class="btn ghost" id="btnSwitchDirection" type="button" style="font-size:12px; padding: 4px 10px;">‰∏≠Êñá ‚Üí EN</button>
                                        <button class="btn ghost" id="btnSkipSentence" type="button" style="font-size:12px; padding: 4px 10px;">Skip</button>
                                    </div>
                                </div>
                                <div class="txt" id="promptText">Welcome home. Do you want bread?</div>
                            </div>

                            <div class="input-area" id="translateInputArea">
                                <input id="userTranslation" inputmode="text" enterkeyhint="go" type="text"
                                    spellcheck="false" placeholder="Type Hanzi and/or Pinyin"
                                    aria-label="Your translation" />
                                <button class="btn primary" id="btnSubmitTranslation" type="button" style="width: 100%;">Check</button>
                            </div>

                            <!-- Feedback section (shown after submit) -->
                            <div id="translateFeedback" class="translate-feedback" style="display:none;">
                                <div id="translateLoader" class="translate-loader" style="display:none;">
                                    <div class="loader-dots">
                                        <span></span>
                                        <span></span>
                                        <span></span>
                                    </div>
                                </div>
                                <div id="feedbackContent" style="display:none;">
                                    <div class="prompt">
                                        <div class="label" style="justify-content:space-between; width:100%">
                                            <span style="display:flex; align-items:center; gap:8px">
                                                <span class="k"
                                                    style="background: var(--purple); box-shadow: 0 0 0 3px rgba(122,92,255,.14)"
                                                    aria-hidden="true"></span>
                                                <span>Summary</span>
                                            </span>
                                        </div>
                                        <div class="txt fb-overview" id="fbOverview">Nice
                                            structure. Two word choices are off, and one word is missing.</div>
                                    </div>

                                    <div class="prompt">
                                        <div class="sentence sentence-correct" id="fbSentence" aria-label="Per-word feedback">
                                        </div>
                                    </div>

                                    <div class="detail" id="fbDetail" aria-live="polite" style="display:none">
                                        <div class="tag"><span class="k" aria-hidden="true"></span><span id="detailTag"></span>
                                        </div>
                                        <div class="dbody" id="detailBody"></div>
                                    </div>

                                    <div class="feedback-actions">
                                        <button class="btn primary" id="btnNextSentence" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS -->
                <div id="screen-settings" class="settings-layout hide">
                    <div class="grid2">
                        <div class="setting-card">
                            <div class="setting-row">
                                <div>
                                    <div class="label">Gemini API key</div>
                                    <div class="hint">Used for Translation Practice</div>
                                </div>
                                <div class="pill" title="Key status"><span
                                        aria-hidden="true">üîë</span><small>Status</small><span id="keyStatus">Not
                                        set</span></div>
                            </div>
                            <input id="apiKey" class="field mono" inputmode="text" type="text" enterkeyhint="done"
                                autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false"
                                placeholder="AIza‚Ä¶" aria-label="Gemini API key" />
                            <div class="setting-row" style="margin-top: 8px;">
                                <div class="label" style="font-size: 13px;">Model</div>
                                <select id="geminiModel" class="field"
                                    style="width: auto; height: 32px; padding: 4px 8px; font-size: 13px;">
                                    <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite</option>
                                    <option value="gemini-3-flash-preview">Gemini 3 Flash (Preview)</option>
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                    <option value="gemini-2.0-pro">Gemini 2.0 Pro</option>
                                </select>
                            </div>
                            <div style="display:flex; gap:10px; margin-top: 12px;">
                                <button class="btn primary" id="btnSaveKey" style="flex:1" type="button">Save</button>
                                <button class="btn ghost" id="btnForgetKey" style="flex:1" type="button">Forget</button>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-row" style="align-items:flex-start; justify-content:space-between">
                                <div>
                                    <div class="label">Import wordlist</div>
                                    <div class="hint">Paste JSON array of {word,pinyin,definition}</div>
                                </div>
                                <div style="display:flex; align-items:center; gap:8px;">
                                    <div class="pill" title="Word count"><span
                                            aria-hidden="true">üìö</span><small>Words</small><span id="wordCount">0</span></div>
                                    <button class="btn ghost" id="btnCopyPrompt" type="button"
                                        style="font-size:12px; padding: 4px 10px;">Copy ChatGPT Prompt</button>
                                </div>
                            </div>

                            <textarea id="wordlistJson" class="textarea-small mono" inputmode="text" enterkeyhint="done"
                                autocapitalize="none" autocorrect="off" spellcheck="false" aria-label="Wordlist JSON"></textarea>

                            <div class="error" id="importError"></div>
                            <div class="ok" id="importOk"></div>

                            <input type="file" id="fileInput" accept=".json,image/*" multiple hidden />
                            <div style="display:flex; gap:10px">
                                <button class="btn primary" id="btnImport" style="flex:1" type="button">Import</button>
                                <button class="btn ghost" id="btnBrowse" style="flex:1" type="button">Browse</button>
                                <button class="btn ghost" id="btnForgetList" style="flex:1"
                                    type="button">Forget</button>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-row">
                                <div>
                                    <div class="label">Generated sentences</div>
                                    <div class="hint">Cached practice sentences from Translation</div>
                                </div>
                                <div class="pill" title="Sentence count"><span
                                        aria-hidden="true">üìù</span><small>Cached</small><span id="sentenceCount">0</span></div>
                            </div>
                            <div style="display:flex; gap:10px; margin-top: 12px;">
                                <button class="btn primary" id="btnViewSentences" style="flex:1" type="button">View All</button>
                                <button class="btn ghost" id="btnForgetSentences" style="flex:1" type="button">Forget</button>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-row">
                                <div>
                                    <div class="label">FSRS-6 Statistics</div>
                                    <div class="hint">Spaced repetition learning stats</div>
                                </div>
                            </div>
                            <div id="fsrsStatsContainer" style="margin-top: 12px;">
                                <!-- Stats will be rendered here -->
                            </div>
                            <div style="display:flex; gap:10px; margin-top: 12px;">
                                <button class="btn ghost" id="btnForgetFSRS" style="flex:1" type="button">Forget</button>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-row">
                                <div>
                                    <div class="label">Cache & Reload</div>
                                    <div class="hint">Clear browser cache and reload page (like Ctrl+F5)</div>
                                </div>
                            </div>
                            <button class="btn ghost" id="btnClearCache" style="width: 100%; margin-top: 12px;" type="button">Clear Cache & Reload</button>
                        </div>

                        <div class="settings-brand" aria-label="Mandalore">
                            <div class="brand-content">
                                <div class="wordmark">Mandalore</div>
                                <div class="version-info" id="versionInfo"></div>
                            </div>
                        </div>
                    </div>
                </div>
        </main>

        <nav>
            <div class="tabbar" role="tablist" aria-label="Playgrounds">
                <button class="tab" id="tabFlash" data-active="true" role="tab" aria-selected="true" type="button">
                    <span class="ico" aria-hidden="true">üÉè</span>
                    <span>Flashcards</span>
                </button>
                <button class="tab" id="tabTranslate" data-active="false" role="tab" aria-selected="false"
                    type="button">
                    <span class="ico" aria-hidden="true">üåê</span>
                    <span>Translation</span>
                </button>
                <button class="tab" id="tabSettings" data-active="false" role="tab" aria-selected="false" type="button">
                    <span class="ico" aria-hidden="true">‚öôÔ∏è</span>
                    <span>Settings</span>
                </button>
            </div>
        </nav>

    </div>

    <!-- Sentences Popup -->
    <div id="sentencesModal" class="modal" style="display: none;">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>Generated Sentences</h3>
                <button class="btn-close" id="btnCloseModal" type="button" aria-label="Close">‚úï</button>
            </div>
            <div class="modal-body" id="sentencesListContainer">
                <!-- Sentences will be populated here -->
            </div>
        </div>
    </div>

    <script src="js/lib/ts-fsrs.js"></script>
    <script type="module" src="js/app.js"></script>
</body>

</html>