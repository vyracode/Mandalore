<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mandalore</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#12142b" />
    <meta name="description" content="A companion web-app for English speakers learning Mandarin" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Mandalore" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Inter:wght@400;700&family=JetBrains+Mono:wght@500;600&family=Noto+Sans+SC:wght@400;700&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app" id="app">

        <main>
            <div class="screen-inner">

                <!-- FLASHCARDS -->
                <div id="screen-flash" class="flash-layout">
                    <div class="card-stack">
                        <div class="front-card" id="frontCard">
                            <div class="front-top">
                                <div class="badge" id="frontBadge"><span class="dot" aria-hidden="true"></span><span
                                        id="frontLabel">Hanzi</span></div>
                            </div>

                            <div class="front-body" id="frontBody">
                                <div class="front-hanzi" id="frontText">Ê¨¢Ëøé</div>
                            </div>

                            <div class="front-foot">
                                <span class="spark" aria-hidden="true"></span><span id="frontHint">Recognize the
                                    word</span>
                            </div>
                        </div>

                        <div class="mod" id="modStack">

                            <!-- Meaning (self-grade after check) -->
                            <div class="mod-card" data-mod="meaning" data-state="input" id="modMeaning">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--orange); box-shadow: 0 0 0 3px rgba(255,176,32,.14)"
                                            aria-hidden="true"></span> Meaning</div>
                                    <div class="mod-actions">
                                        <button class="btn mod-input" data-action="checkMeaning" type="button">Check</button>
                                    </div>
                                </div>
                                <div class="mod-body mod-checked">
                                    <div class="checked-row">
                                        <div class="checked-answer" data-role="meaningAnswer"></div>
                                        <div class="checked-grade" data-role="meaningSelf">
                                            <button class="btn-grade good" data-action="selfRight" type="button" aria-label="Right">‚úì</button>
                                            <button class="btn-grade bad" data-action="selfWrong" type="button" aria-label="Wrong">‚úó</button>
                                        </div>
                                    </div>
                                    <div class="checked-result" data-role="meaningResult">
                                        <span class="r-dot" aria-hidden="true"></span>
                                        <span data-role="meaningMsg"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- Hanzi (multiple choice) -->
                            <div class="mod-card" data-mod="hanzi" data-state="input" id="modHanzi">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--cyan); box-shadow: 0 0 0 3px rgba(40,216,255,.14)"
                                            aria-hidden="true"></span> Hanzi</div>
                                    <div class="mod-actions">
                                        <div class="checked-result compact" data-role="hanziResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="hanziMsg"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mod-body">
                                    <div class="choices" role="group" aria-label="Hanzi choices">
                                        <button class="choice" data-choice type="button">Ê¨¢Ëøé</button>
                                        <button class="choice" data-choice type="button">ÁéØÂ¢É</button>
                                        <button class="choice" data-choice type="button">ÁºìÂ∫î</button>
                                        <button class="choice" data-choice type="button">Ê¨¢È•Æ</button>
                                        <button class="choice" data-choice type="button">Ê¨¢ËøéÂêß</button>
                                        <button class="choice" data-choice type="button">Ê¨¢ÂΩ±</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Pinyin spelling (graded) -->
                            <div class="mod-card" data-mod="pinyin" data-state="input" id="modPinyin">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini"
                                            style="background: var(--purple); box-shadow: 0 0 0 3px rgba(122,92,255,.14)"
                                            aria-hidden="true"></span> Spelling</div>
                                    <div class="mod-actions"></div>
                                </div>
                                <div class="mod-body">
                                    <div class="row mod-input">
                                        <input class="field" inputmode="latin" type="text" enterkeyhint="go"
                                            autocapitalize="none" autocorrect="off" placeholder="pinyin (no tones)" 
                                            data-input="pinyin" aria-label="Pinyin spelling" />
                                        <button class="btn" data-action="checkPinyin" type="button">Check</button>
                                    </div>
                                    <div class="checked-row mod-checked">
                                        <div class="checked-result" data-role="pinyinResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="pinyinMsg"></span>
                                        </div>
                                        <div class="checked-answer" data-role="pinyinAnswer"></div>
                                        <button class="btn" data-action="coverPinyin" data-role="pinyinCover" type="button">Cover</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Pronunciation -->
                            <div class="mod-card" data-mod="pronunciation" data-state="input" id="modPron">
                                <div class="mod-head">
                                    <div class="chip"><span class="mini" aria-hidden="true"></span> Pronunciation</div>
                                    <div class="mod-actions"></div>
                                </div>

                                <div class="mod-body pron">
                                    <div class="pron-block pron-tone" data-pron-state="input">
                                        <div class="row mod-input" style="justify-content:space-between">
                                            <input class="field" inputmode="numeric" type="tel" enterkeyhint="go"
                                                pattern="[0-9]*" autocorrect="off" placeholder="tone numbers" 
                                                data-input="tone" aria-label="Tone numbers" />
                                            <button class="btn" data-action="checkTone" type="button">Check</button>
                                        </div>
                                        <div class="checked-row mod-checked">
                                            <div class="checked-result" data-role="toneResult">
                                                <span class="r-dot" aria-hidden="true"></span>
                                                <span data-role="toneMsg"></span>
                                            </div>
                                            <div class="checked-answer" data-role="toneAnswer"></div>
                                        </div>
                                    </div>

                                    <div class="pron-divider" aria-hidden="true"></div>

                                    <div class="pron-block pron-speak" data-pron-state="input">
                                        <div class="row mod-input" style="justify-content:space-between">
                                            <div class="chip" style="background: rgba(0,0,0,.12)"><span class="mini"
                                                    style="background: var(--cyan); box-shadow: 0 0 0 3px rgba(40,216,255,.14)"
                                                    aria-hidden="true"></span> Say it out loud</div>
                                            <button class="btn" data-action="checkSpeech" type="button">Check</button>
                                        </div>
                                        <div class="checked-row mod-checked">
                                            <div class="checked-audio" data-role="speechAnswer"></div>
                                            <div class="checked-grade" data-role="speechSelf">
                                                <button class="btn-grade good" data-action="selfRight" type="button" aria-label="Right">‚úì</button>
                                                <button class="btn-grade bad" data-action="selfWrong" type="button" aria-label="Wrong">‚úó</button>
                                            </div>
                                        </div>
                                        <div class="checked-result" data-role="speechResult">
                                            <span class="r-dot" aria-hidden="true"></span>
                                            <span data-role="speechMsg"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- TRANSLATION -->
                <div id="screen-translate" class="translate-layout hide">
                    <div class="panel">
                        <div class="ph">
                            <h2>Translation</h2>
                            <div class="seg" role="tablist" aria-label="Translation direction">
                                <button id="dirENZH" data-on="true" role="tab" aria-selected="true" type="button">EN ‚Üí
                                    ‰∏≠Êñá</button>
                                <button id="dirZHEN" data-on="false" role="tab" aria-selected="false" type="button">‰∏≠Êñá ‚Üí
                                    EN</button>
                            </div>
                        </div>
                    </div>

                    <div class="translate-card">
                        <!-- A -->
                        <div id="translateA" style="display:flex; flex-direction:column; gap:12px; min-height:0;">
                            <div class="prompt">
                                <div class="label"><span class="k" aria-hidden="true"></span><span
                                        id="translateLabel">Translate into ‰∏≠Êñá</span></div>
                                <div class="txt" id="promptText">Welcome home. Do you want bread?</div>
                            </div>

                            <div class="input-area">
                                <textarea id="userTranslation" inputmode="text" enterkeyhint="send"
                                    spellcheck="false" placeholder="Type Hanzi, Pinyin, and/or English"
                                    aria-label="Your translation"></textarea>
                                <div class="translate-actions">
                                    <button class="btn ghost" id="btnNewSentence" type="button">New sentence</button>
                                    <button class="btn primary" id="btnSubmitTranslation" type="button">Check</button>
                                </div>
                            </div>
                        </div>

                        <!-- B -->
                        <div id="translateB" class="feedback">
                            <div class="prompt" style="gap:6px">
                                <div class="label" style="justify-content:space-between; width:100%">
                                    <span style="display:flex; align-items:center; gap:8px">
                                        <span class="k"
                                            style="background: var(--purple); box-shadow: 0 0 0 3px rgba(122,92,255,.14)"
                                            aria-hidden="true"></span>
                                        <span>Summary</span>
                                    </span>
                                    <button class="btn ghost" id="btnBackToInput" type="button">Back</button>
                                </div>
                                <div class="txt" id="fbOverview"
                                    style="font-size:14px; font-weight:850; color: rgba(255,255,255,.86)">Nice
                                    structure. Two word choices are off, and one word is missing.</div>
                            </div>

                            <div class="prompt" style="gap:10px">
                                <div class="sentence sentence-correct" id="fbSentence" aria-label="Per-word feedback">
                                </div>
                            </div>

                            <div class="detail" id="fbDetail" aria-live="polite" style="display:none">
                                <div class="tag"><span class="k" aria-hidden="true"></span><span id="detailTag"></span>
                                </div>
                                <div class="dbody" id="detailBody"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SETTINGS -->
                <div id="screen-settings" class="settings-layout hide">
                    <div class="panel">
                        <div class="ph">
                            <h2>Settings</h2>
                        </div>
                    </div>

                    <div class="grid2">
                        <div class="setting-card">
                            <div class="setting-row">
                                <div>
                                    <div class="label">Gemini API key</div>
                                    <div class="hint">Used for Translation Practice</div>
                                </div>
                                <div class="pill" title="Key status"><span
                                        aria-hidden="true">üîë</span><small>Status</small><span id="keyStatus">Not
                                        set</span></div>
                            </div>
                            <input id="apiKey" class="field mono" inputmode="text" type="text" enterkeyhint="done"
                                autocapitalize="none" autocorrect="off" autocomplete="off" spellcheck="false"
                                placeholder="AIza‚Ä¶" aria-label="Gemini API key" />
                            <div class="setting-row" style="margin-top: 8px;">
                                <div class="label" style="font-size: 13px;">Model</div>
                                <select id="geminiModel" class="field"
                                    style="width: auto; height: 32px; padding: 4px 8px; font-size: 13px;">
                                    <option value="gemini-2.5-flash-lite-preview-06-17">Gemini 2.5 Flash-Lite</option>
                                    <option value="gemini-3-flash-preview">Gemini 3 Flash (Preview)</option>
                                    <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                    <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                                    <option value="gemini-2.0-pro">Gemini 2.0 Pro</option>
                                </select>
                            </div>
                            <div style="display:flex; gap:10px; margin-top: 12px;">
                                <button class="btn primary" id="btnSaveKey" style="flex:1" type="button">Save</button>
                                <button class="btn ghost" id="btnForgetKey" style="flex:1" type="button">Forget</button>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-row" style="align-items:flex-start; justify-content:space-between">
                                <div>
                                    <div class="label">Import wordlist</div>
                                    <div class="hint">Paste JSON array of {word,pinyin,definition}</div>
                                </div>
                                <button class="btn ghost" id="btnCopyPrompt" type="button"
                                    style="font-size:12px; padding: 4px 10px;">Copy ChatGPT Prompt</button>
                            </div>

                            <textarea id="wordlistJson" class="textarea-small mono" inputmode="text" enterkeyhint="done"
                                autocapitalize="none" autocorrect="off" spellcheck="false" aria-label="Wordlist JSON">[
  {"word":"Ê¨¢Ëøé","pinyin":"huƒÅny√≠ng","definition":"welcome"},
  {"word":"Èù¢ÂåÖ","pinyin":"mi√†nbƒÅo","definition":"bread"}
]</textarea>

                            <div class="error" id="importError"></div>
                            <div class="ok" id="importOk"></div>

                            <input type="file" id="fileInput" accept=".json,image/*" multiple hidden />
                            <div style="display:flex; gap:10px">
                                <button class="btn primary" id="btnImport" style="flex:1" type="button">Import</button>
                                <button class="btn ghost" id="btnBrowse" style="flex:1" type="button">Browse</button>
                                <button class="btn ghost" id="btnForgetList" style="flex:1"
                                    type="button">Forget</button>
                            </div>
                        </div>

                        <div class="setting-card">
                            <div class="setting-row">
                                <div>
                                    <div class="label">Word Assets</div>
                                    <div class="hint">Select folder containing audio (.mp3, .wav, .ogg) and image (.jpg, .png, .webp) files</div>
                                </div>
                                <div class="pill" title="Asset status"><span
                                        aria-hidden="true">üìÅ</span><small>Status</small><span id="assetStatus">Not set</span></div>
                            </div>
                            <input type="file" id="assetFolderInput" webkitdirectory directory multiple hidden />
                            <div style="display:flex; gap:10px; margin-top: 12px;">
                                <button class="btn primary" id="btnSelectAssets" style="flex:1" type="button">Select Folder</button>
                                <button class="btn ghost" id="btnClearAssets" style="flex:1" type="button">Clear</button>
                            </div>
                        </div>

                        <div class="setting-card" id="pwaInstallCard" style="display:none">
                            <div class="setting-row">
                                <div>
                                    <div class="label">Install App</div>
                                    <div class="hint">Install Mandalore as a Progressive Web App for offline access</div>
                                </div>
                                <div class="pill" title="Install status"><span
                                        aria-hidden="true">üì±</span><small>Status</small><span id="pwaInstallStatus">Available</span></div>
                            </div>
                            <button class="btn primary" id="btnInstallPWA" style="width:100%; margin-top: 12px;" type="button">Install Mandalore</button>
                        </div>
                    </div>

                    <div class="settings-brand" aria-label="Mandalore">
                        <div class="wordmark">Mandalore</div>
                    </div>
                </div>
        </main>

        <nav>
            <div class="tabbar" role="tablist" aria-label="Playgrounds">
                <button class="tab" id="tabFlash" data-active="true" role="tab" aria-selected="true" type="button">
                    <span class="ico" aria-hidden="true">üÉè</span>
                    <span>Flashcards</span>
                </button>
                <button class="tab" id="tabTranslate" data-active="false" role="tab" aria-selected="false"
                    type="button">
                    <span class="ico" aria-hidden="true">üåê</span>
                    <span>Translation</span>
                </button>
                <button class="tab" id="tabSettings" data-active="false" role="tab" aria-selected="false" type="button">
                    <span class="ico" aria-hidden="true">‚öôÔ∏è</span>
                    <span>Settings</span>
                </button>
            </div>
        </nav>

        <button class="btn primary fab-next" id="btnFabNext" type="button" aria-label="Next card">
            Next <span aria-hidden="true">‚Üí</span>
        </button>

    </div>

    <script type="module" src="js/app.js"></script>
</body>

</html>