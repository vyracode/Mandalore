/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/ts-fsrs@5.2.3/dist/index.umd.js
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).FSRS={})}(this,(function(t){"use strict";var e=(t=>(t[t.New=0]="New",t[t.Learning=1]="Learning",t[t.Review=2]="Review",t[t.Relearning=3]="Relearning",t))(e||{}),i=(t=>(t[t.Manual=0]="Manual",t[t.Again=1]="Again",t[t.Hard=2]="Hard",t[t.Good=3]="Good",t[t.Easy=4]="Easy",t))(i||{}),r=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(t,e,i)=>e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,h=(t,e)=>{for(var i in e||(e={}))l.call(e,i)&&d(t,i,e[i]);if(n)for(var i of n(e))o.call(e,i)&&d(t,i,e[i]);return t},u=(t,e)=>s(t,a(e));class c{static card(t){return u(h({},t),{state:c.state(t.state),due:c.time(t.due),last_review:t.last_review?c.time(t.last_review):void 0})}static rating(t){if("string"==typeof t){const e=t.charAt(0).toUpperCase(),r=t.slice(1).toLowerCase(),s=i[`${e}${r}`];if(void 0===s)throw new Error(`Invalid rating:[${t}]`);return s}if("number"==typeof t)return t;throw new Error(`Invalid rating:[${t}]`)}static state(t){if("string"==typeof t){const i=t.charAt(0).toUpperCase(),r=t.slice(1).toLowerCase(),s=e[`${i}${r}`];if(void 0===s)throw new Error(`Invalid state:[${t}]`);return s}if("number"==typeof t)return t;throw new Error(`Invalid state:[${t}]`)}static time(t){const e=new Date(t);if("object"==typeof t&&null!==t&&!Number.isNaN(Date.parse(t)||+e))return e;if("string"==typeof t){const e=Date.parse(t);if(Number.isNaN(e))throw new Error(`Invalid date:[${t}]`);return new Date(e)}if("number"==typeof t)return new Date(t);throw new Error(`Invalid date:[${t}]`)}static review_log(t){return u(h({},t),{due:c.time(t.due),rating:c.rating(t.rating),state:c.state(t.state),review:c.time(t.review)})}}function f(t,e,i){return new Date(i?c.time(t).getTime()+24*e*60*60*1e3:c.time(t).getTime()+60*e*1e3)}function _(t,e,i){if(!t||!e)throw new Error("Invalid date");const r=c.time(t).getTime()-c.time(e).getTime();let s=0;switch(i){case"days":s=Math.floor(r/864e5);break;case"minutes":s=Math.floor(r/6e4)}return s}function g(t){const e=c.time(t),i=e.getFullYear(),r=e.getMonth()+1,s=e.getDate(),a=e.getHours(),n=e.getMinutes(),l=e.getSeconds();return`${i}-${y(r)}-${y(s)} ${y(a)}:${y(n)}:${y(l)}`}function y(t){return t<10?`0${t}`:`${t}`}Date.prototype.scheduler=function(t,e){return f(this,t,e)},Date.prototype.diff=function(t,e){return _(this,t,e)},Date.prototype.format=function(){return g(this)},Date.prototype.dueFormat=function(t,e,i){return w(this,t,e,i)};const p=[60,60,24,31,12],m=["second","min","hour","day","month","year"];function w(t,e,i,r=m){t=c.time(t),e=c.time(e),r.length!==m.length&&(r=m);let s=t.getTime()-e.getTime(),a=0;for(s/=1e3,a=0;a<p.length&&!(s<p[a]);a++)s/=p[a];return`${Math.floor(s)}${i?r[a]:""}`}const v=Object.freeze([i.Again,i.Hard,i.Good,i.Easy]),b=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function x(t,e,i){let r=1;for(const e of b)r+=e.factor*Math.max(Math.min(t,e.end)-e.start,0);t=Math.min(t,i);let s=Math.max(2,Math.round(t-r));const a=Math.min(Math.round(t+r),i);return t>e&&(s=Math.max(s,e+1)),s=Math.min(s,a),{min_ivl:s,max_ivl:a}}function M(t,e,i){return Math.min(Math.max(t,e),i)}function S(t,e){const i=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),r=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((r-i)/864e5)}const E=t=>{const e=t.slice(-1),i=parseInt(t.slice(0,-1),10);if(Number.isNaN(i)||!Number.isFinite(i)||i<0)throw new Error(`Invalid step value: ${t}`);switch(e){case"m":return i;case"h":return 60*i;case"d":return 1440*i;default:throw new Error(`Invalid step unit: ${t}, expected m/h/d`)}},R=(t,r,s)=>{const a=r===e.Relearning||r===e.Review?t.relearning_steps:t.learning_steps,n=a.length;if(0===n||s>=n)return{};const l=a[0],o=E,d=()=>{if(1===n)return Math.round(1.5*o(l));const t=a[1];return Math.round((o(l)+o(t))/2)},h=t=>t<0||t>=n?null:a[t],u={},c=h(Math.max(0,s));if(r===e.Review)return u[i.Again]={scheduled_minutes:o(c),next_step:0},u;{u[i.Again]={scheduled_minutes:o(l),next_step:0},u[i.Hard]={scheduled_minutes:d(),next_step:s};const t=h(s+1);if(t){const e=o(t);e&&(u[i.Good]={scheduled_minutes:Math.round(e),next_step:s+1})}}return u};function N(){return`${this.review_time.getTime()}_${this.current.reps}_${this.current.difficulty*this.current.stability}`}var A=(t=>(t.SCHEDULER="Scheduler",t.LEARNING_STEPS="LearningSteps",t.SEED="Seed",t))(A||{}),F=Object.defineProperty,D=(t,e,i)=>((t,e,i)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);class O{constructor(t,e,i,r){D(this,"last"),D(this,"current"),D(this,"review_time"),D(this,"next",new Map),D(this,"algorithm"),D(this,"strategies"),D(this,"elapsed_days",0),this.algorithm=i,this.last=c.card(t),this.current=c.card(t),this.review_time=c.time(e),this.strategies=r,this.init()}checkGrade(t){if(!Number.isFinite(t)||t<0||t>4)throw new Error(`Invalid grade "${t}",expected 1-4`)}init(){const{state:t,last_review:i}=this.current;let r=0;t!==e.New&&i&&(r=S(i,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=r,this.current.elapsed_days=r,this.current.reps+=1;let s=N;if(this.strategies){const t=this.strategies.get(A.SEED);t&&(s=t)}this.algorithm.seed=s.call(this)}preview(){return{[i.Again]:this.review(i.Again),[i.Hard]:this.review(i.Hard),[i.Good]:this.review(i.Good),[i.Easy]:this.review(i.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(const t of v)yield this.review(t)}review(t){const{state:i}=this.last;let r;switch(this.checkGrade(t),i){case e.New:r=this.newState(t);break;case e.Learning:case e.Relearning:r=this.learningState(t);break;case e.Review:r=this.reviewState(t)}return r}buildLog(t){const{last_review:e,due:i,elapsed_days:r}=this.last;return{rating:t,state:this.current.state,due:e||i,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:r,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}var L=Object.defineProperty,$=(t,e,i)=>((t,e,i)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);class I{constructor(t){$(this,"c"),$(this,"s0"),$(this,"s1"),$(this,"s2");const e=function(){let t=4022871197;return function(e){e=String(e);for(let i=0;i<e.length;i++){t+=e.charCodeAt(i);let r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return 2.3283064365386963e-10*(t>>>0)}}();this.c=1,this.s0=e(" "),this.s1=e(" "),this.s2=e(" "),null==t&&(t=Date.now()),this.s0-=e(t),this.s0<0&&(this.s0+=1),this.s1-=e(t),this.s1<0&&(this.s1+=1),this.s2-=e(t),this.s2<0&&(this.s2+=1)}next(){const t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.c=0|t,this.s2=t-this.c,this.s2}set state(t){this.c=t.c,this.s0=t.s0,this.s1=t.s1,this.s2=t.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}const j=!1,H=!0,P=Object.freeze(["1m","10m"]),T=Object.freeze(["10m"]),C=.001,G=100,z=.1542,U=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,z]),q=(t,e=true)=>[[C,G],[C,G],[C,G],[C,G],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,t],[0,t],[e?.01:0,.8],[.1,.8]],k=(t,e,i=true)=>{let r=2;if(Math.max(0,e)>1){r=M(+(-(Math.log(t[11])+Math.log(Math.pow(2,t[13])-1)+.3*t[14])/e).toFixed(8),.01,2)}return q(r,i).slice(0,t.length).map((([e,i],r)=>M(t[r]||0,e,i)))},Y=(t,e=0,i=true)=>{if(void 0===t)return[...U];switch(t.length){case 21:return k(Array.from(t),e,i);case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),k(Array.from(t),e,i).concat([0,.5]);case 17:{const r=k(Array.from(t),e,i);return r[4]=+(2*r[5]+r[4]).toFixed(8),r[5]=+(Math.log(3*r[5]+1)/3).toFixed(8),r[6]=+(r[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),r.concat([0,0,0,.5])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...U]}},W=t=>{var e,i;const r=Array.isArray(null==t?void 0:t.learning_steps)?t.learning_steps:P,s=Array.isArray(null==t?void 0:t.relearning_steps)?t.relearning_steps:T,a=null!=(e=null==t?void 0:t.enable_short_term)?e:H,n=Y(null==t?void 0:t.w,s.length,a);return{request_retention:(null==t?void 0:t.request_retention)||.9,maximum_interval:(null==t?void 0:t.maximum_interval)||36500,w:n,enable_fuzz:null!=(i=null==t?void 0:t.enable_fuzz)?i:j,enable_short_term:a,learning_steps:r,relearning_steps:s}};function B(t,i){const r={due:t?c.time(t):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:e.New,last_review:void 0};return i&&"function"==typeof i?i(r):r}var X=Object.defineProperty,V=(t,e,i)=>((t,e,i)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);const J=t=>{const e="number"==typeof t?-t:-t[20];return{decay:e,factor:+(Math.exp(Math.pow(e,-1)*Math.log(.9))-1).toFixed(8)}};function K(t,e,i){const{decay:r,factor:s}=J(t);return+Math.pow(1+s*e/i,r).toFixed(8)}class Q{constructor(t){V(this,"param"),V(this,"intervalModifier"),V(this,"_seed"),V(this,"forgetting_curve"),this.param=new Proxy(W(t),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=K.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(t){this._seed=t}calculate_interval_modifier(t){if(t<=0||t>1)throw new Error("Requested retention rate should be in the range (0,1]");const{decay:e,factor:i}=J(this.param.w);return+((Math.pow(t,1/e)-1)/i).toFixed(8)}get parameters(){return this.param}set parameters(t){this.update_parameters(t)}params_handler_proxy(){const t=this;return{set:function(e,i,r){return"request_retention"===i&&Number.isFinite(r)?t.intervalModifier=t.calculate_interval_modifier(Number(r)):"w"===i&&(r=Y(r,e.relearning_steps.length,e.enable_short_term),t.forgetting_curve=K.bind(this,r),t.intervalModifier=t.calculate_interval_modifier(Number(e.request_retention))),Reflect.set(e,i,r),!0}}}update_parameters(t){const e=W(t);for(const t in e){const i=t;this.param[i]=e[i]}}init_stability(t){return Math.max(this.param.w[t-1],.1)}init_difficulty(t){return+(this.param.w[4]-Math.exp((t-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(t,e){if(!this.param.enable_fuzz||t<2.5)return Math.round(t);const i=function(t){const e=new I(t),i=()=>e.next();return i.int32=()=>4294967296*e.next()|0,i.double=()=>i()+11102230246251565e-32*(2097152*i()|0),i.state=()=>e.state,i.importState=t=>(e.state=t,i),i}(this._seed)(),{min_ivl:r,max_ivl:s}=x(t,e,this.param.maximum_interval);return Math.floor(i*(s-r+1)+r)}next_interval(t,e){const i=Math.min(Math.max(1,Math.round(t*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(i,e)}linear_damping(t,e){return+(t*(10-e)/9).toFixed(8)}next_difficulty(t,e){const r=-this.param.w[6]*(e-3),s=t+this.linear_damping(r,t);return M(this.mean_reversion(this.init_difficulty(i.Easy),s),1,10)}mean_reversion(t,e){return+(this.param.w[7]*t+(1-this.param.w[7])*e).toFixed(8)}next_recall_stability(t,e,r,s){const a=i.Hard===s?this.param.w[15]:1,n=i.Easy===s?this.param.w[16]:1;return+M(e*(1+Math.exp(this.param.w[8])*(11-t)*Math.pow(e,-this.param.w[9])*(Math.exp((1-r)*this.param.w[10])-1)*a*n),C,36500).toFixed(8)}next_forget_stability(t,e,i){return+M(this.param.w[11]*Math.pow(t,-this.param.w[12])*(Math.pow(e+1,this.param.w[13])-1)*Math.exp((1-i)*this.param.w[14]),C,36500).toFixed(8)}next_short_term_stability(t,e){const i=Math.pow(t,-this.param.w[19])*Math.exp(this.param.w[17]*(e-3+this.param.w[18]));return+M(t*(e>=3?Math.max(i,1):i),C,36500).toFixed(8)}next_state(t,e,i){const{difficulty:r,stability:s}=null!=t?t:{difficulty:0,stability:0};if(e<0)throw new Error(`Invalid delta_t "${e}"`);if(i<0||i>4)throw new Error(`Invalid grade "${i}"`);if(0===r&&0===s)return{difficulty:M(this.init_difficulty(i),1,10),stability:this.init_stability(i)};if(0===i)return{difficulty:r,stability:s};if(r<1||s<C)throw new Error(`Invalid memory state { difficulty: ${r}, stability: ${s} }`);const a=this.forgetting_curve(e,s),n=this.next_recall_stability(r,s,a,i),l=this.next_forget_stability(r,s,a),o=this.next_short_term_stability(s,i);let d=n;if(1===i){let[t,e]=[0,0];this.param.enable_short_term&&(t=this.param.w[17],e=this.param.w[18]);d=M(+(s/Math.exp(t*e)).toFixed(8),C,l)}0===e&&this.param.enable_short_term&&(d=o);return{difficulty:this.next_difficulty(r,i),stability:d}}}var Z=Object.defineProperty,tt=(t,e,i)=>((t,e,i)=>e in t?Z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,e+"",i);class et extends O{constructor(t,e,i,r){super(t,e,i,r),tt(this,"learningStepsStrategy");let s=R;if(this.strategies){const t=this.strategies.get(A.LEARNING_STEPS);t&&(s=t)}this.learningStepsStrategy=s}getLearningInfo(t,r){var s,a,n,l;const o=this.algorithm.parameters;t.learning_steps=t.learning_steps||0;const d=this.learningStepsStrategy(o,t.state,this.current.state===e.Learning&&r!==i.Again&&r!==i.Hard?t.learning_steps+1:t.learning_steps);return{scheduled_minutes:Math.max(0,null!=(a=null==(s=d[r])?void 0:s.scheduled_minutes)?a:0),next_steps:Math.max(0,null!=(l=null==(n=d[r])?void 0:n.next_step)?l:0)}}applyLearningSteps(t,i,r){const{scheduled_minutes:s,next_steps:a}=this.getLearningInfo(this.current,i);if(s>0&&s<1440)t.learning_steps=a,t.scheduled_days=0,t.state=r,t.due=f(this.review_time,Math.round(s),!1);else if(t.state=e.Review,s>=1440)t.learning_steps=a,t.due=f(this.review_time,Math.round(s),!1),t.scheduled_days=Math.floor(s/1440);else{t.learning_steps=0;const e=this.algorithm.next_interval(t.stability,this.elapsed_days);t.scheduled_days=e,t.due=f(this.review_time,e,!0)}}newState(t){const i=this.next.get(t);if(i)return i;const r=c.card(this.current);r.difficulty=M(this.algorithm.init_difficulty(t),1,10),r.stability=this.algorithm.init_stability(t),this.applyLearningSteps(r,t,e.Learning);const s={card:r,log:this.buildLog(t)};return this.next.set(t,s),s}learningState(t){const e=this.next.get(t);if(e)return e;const{state:i,difficulty:r,stability:s}=this.last,a=c.card(this.current);a.difficulty=this.algorithm.next_difficulty(r,t),a.stability=this.algorithm.next_short_term_stability(s,t),this.applyLearningSteps(a,t,i);const n={card:a,log:this.buildLog(t)};return this.next.set(t,n),n}reviewState(t){const r=this.next.get(t);if(r)return r;const s=this.elapsed_days,{difficulty:a,stability:n}=this.last,l=this.algorithm.forgetting_curve(s,n),o=c.card(this.current),d=c.card(this.current),h=c.card(this.current),u=c.card(this.current);this.next_ds(o,d,h,u,a,n,l),this.next_interval(d,h,u,s),this.next_state(d,h,u),this.applyLearningSteps(o,i.Again,e.Relearning),o.lapses+=1;const f={card:o,log:this.buildLog(i.Again)},_={card:d,log:super.buildLog(i.Hard)},g={card:h,log:super.buildLog(i.Good)},y={card:u,log:super.buildLog(i.Easy)};return this.next.set(i.Again,f),this.next.set(i.Hard,_),this.next.set(i.Good,g),this.next.set(i.Easy,y),this.next.get(t)}next_ds(t,e,r,s,a,n,l){t.difficulty=this.algorithm.next_difficulty(a,i.Again);const o=n/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),d=this.algorithm.next_forget_stability(a,n,l);t.stability=M(+o.toFixed(8),C,d),e.difficulty=this.algorithm.next_difficulty(a,i.Hard),e.stability=this.algorithm.next_recall_stability(a,n,l,i.Hard),r.difficulty=this.algorithm.next_difficulty(a,i.Good),r.stability=this.algorithm.next_recall_stability(a,n,l,i.Good),s.difficulty=this.algorithm.next_difficulty(a,i.Easy),s.stability=this.algorithm.next_recall_stability(a,n,l,i.Easy)}next_interval(t,e,i,r){let s,a;s=this.algorithm.next_interval(t.stability,r),a=this.algorithm.next_interval(e.stability,r),s=Math.min(s,a),a=Math.max(a,s+1);const n=Math.max(this.algorithm.next_interval(i.stability,r),a+1);t.scheduled_days=s,t.due=f(this.review_time,s,!0),e.scheduled_days=a,e.due=f(this.review_time,a,!0),i.scheduled_days=n,i.due=f(this.review_time,n,!0)}next_state(t,i,r){t.state=e.Review,t.learning_steps=0,i.state=e.Review,i.learning_steps=0,r.state=e.Review,r.learning_steps=0}}class it extends O{newState(t){const e=this.next.get(t);if(e)return e;this.current.scheduled_days=0,this.current.elapsed_days=0;const i=c.card(this.current),r=c.card(this.current),s=c.card(this.current),a=c.card(this.current);this.init_ds(i,r,s,a);return this.next_interval(i,r,s,a,0),this.next_state(i,r,s,a),this.update_next(i,r,s,a),this.next.get(t)}init_ds(t,e,r,s){t.difficulty=M(this.algorithm.init_difficulty(i.Again),1,10),t.stability=this.algorithm.init_stability(i.Again),e.difficulty=M(this.algorithm.init_difficulty(i.Hard),1,10),e.stability=this.algorithm.init_stability(i.Hard),r.difficulty=M(this.algorithm.init_difficulty(i.Good),1,10),r.stability=this.algorithm.init_stability(i.Good),s.difficulty=M(this.algorithm.init_difficulty(i.Easy),1,10),s.stability=this.algorithm.init_stability(i.Easy)}learningState(t){return this.reviewState(t)}reviewState(t){const e=this.next.get(t);if(e)return e;const i=this.elapsed_days,{difficulty:r,stability:s}=this.last,a=this.algorithm.forgetting_curve(i,s),n=c.card(this.current),l=c.card(this.current),o=c.card(this.current),d=c.card(this.current);return this.next_ds(n,l,o,d,r,s,a),this.next_interval(n,l,o,d,i),this.next_state(n,l,o,d),n.lapses+=1,this.update_next(n,l,o,d),this.next.get(t)}next_ds(t,e,r,s,a,n,l){t.difficulty=this.algorithm.next_difficulty(a,i.Again);const o=this.algorithm.next_forget_stability(a,n,l);t.stability=M(n,C,o),e.difficulty=this.algorithm.next_difficulty(a,i.Hard),e.stability=this.algorithm.next_recall_stability(a,n,l,i.Hard),r.difficulty=this.algorithm.next_difficulty(a,i.Good),r.stability=this.algorithm.next_recall_stability(a,n,l,i.Good),s.difficulty=this.algorithm.next_difficulty(a,i.Easy),s.stability=this.algorithm.next_recall_stability(a,n,l,i.Easy)}next_interval(t,e,i,r,s){let a,n,l,o;a=this.algorithm.next_interval(t.stability,s),n=this.algorithm.next_interval(e.stability,s),l=this.algorithm.next_interval(i.stability,s),o=this.algorithm.next_interval(r.stability,s),a=Math.min(a,n),n=Math.max(n,a+1),l=Math.max(l,n+1),o=Math.max(o,l+1),t.scheduled_days=a,t.due=f(this.review_time,a,!0),e.scheduled_days=n,e.due=f(this.review_time,n,!0),i.scheduled_days=l,i.due=f(this.review_time,l,!0),r.scheduled_days=o,r.due=f(this.review_time,o,!0)}next_state(t,i,r,s){t.state=e.Review,t.learning_steps=0,i.state=e.Review,i.learning_steps=0,r.state=e.Review,r.learning_steps=0,s.state=e.Review,s.learning_steps=0}update_next(t,e,r,s){const a={card:t,log:this.buildLog(i.Again)},n={card:e,log:super.buildLog(i.Hard)},l={card:r,log:super.buildLog(i.Good)},o={card:s,log:super.buildLog(i.Easy)};this.next.set(i.Again,a),this.next.set(i.Hard,n),this.next.set(i.Good,l),this.next.set(i.Easy,o)}}var rt=Object.defineProperty,st=Object.defineProperties,at=Object.getOwnPropertyDescriptors,nt=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,dt=(t,e,i)=>e in t?rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;class ht{constructor(t){var e;dt(this,"fsrs"+"",e),this.fsrs=t}replay(t,e,i){return this.fsrs.next(t,e,i)}handleManualRating(t,r,s,a,n,l,o){if(void 0===r)throw new Error("reschedule: state is required for manual rating");let d,h;if(r===e.New)d={rating:i.Manual,state:r,due:null!=o?o:s,stability:t.stability,difficulty:t.difficulty,elapsed_days:a,last_elapsed_days:t.elapsed_days,scheduled_days:t.scheduled_days,learning_steps:t.learning_steps,review:s},h=B(s),h.last_review=s;else{if(void 0===o)throw new Error("reschedule: due is required for manual rating");const e=_(o,s,"days");d={rating:i.Manual,state:t.state,due:t.last_review||t.due,stability:t.stability,difficulty:t.difficulty,elapsed_days:a,last_elapsed_days:t.elapsed_days,scheduled_days:t.scheduled_days,learning_steps:t.learning_steps,review:s},u=((t,e)=>{for(var i in e||(e={}))lt.call(e,i)&&dt(t,i,e[i]);if(nt)for(var i of nt(e))ot.call(e,i)&&dt(t,i,e[i]);return t})({},t),c={state:r,due:o,last_review:s,stability:n||t.stability,difficulty:l||t.difficulty,elapsed_days:a,scheduled_days:e,reps:t.reps+1},h=st(u,at(c))}var u,c;return{card:h,log:d}}reschedule(t,r){const s=[];let a=B(t.due);for(const t of r){let r;if(t.review=c.time(t.review),t.rating===i.Manual){let i=0;a.state!==e.New&&a.last_review&&(i=_(t.review,a.last_review,"days")),r=this.handleManualRating(a,t.state,t.review,i,t.stability,t.difficulty,t.due?c.time(t.due):void 0)}else r=this.replay(a,t.review,t.rating);s.push(r),a=r.card}return s}calculateManualRecord(t,e,i,r){if(!i)return null;const{card:s,log:a}=i,n=c.card(t);return n.due.getTime()===s.due.getTime()?null:(n.scheduled_days=_(s.due,n.due,"days"),this.handleManualRating(n,s.state,c.time(e),a.elapsed_days,r?s.stability:void 0,r?s.difficulty:void 0,s.due))}}var ut=Object.defineProperty,ct=Object.defineProperties,ft=Object.getOwnPropertyDescriptors,_t=Object.getOwnPropertySymbols,gt=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,pt=(t,e,i)=>e in t?ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,mt=(t,e)=>{for(var i in e||(e={}))gt.call(e,i)&&pt(t,i,e[i]);if(_t)for(var i of _t(e))yt.call(e,i)&&pt(t,i,e[i]);return t},wt=(t,e)=>ct(t,ft(e)),vt=(t,e,i)=>pt(t,"symbol"!=typeof e?e+"":e,i);class bt extends Q{constructor(t){super(t),vt(this,"strategyHandler",new Map),vt(this,"Scheduler");const{enable_short_term:e}=this.parameters;this.Scheduler=e?et:it}params_handler_proxy(){const t=this;return{set:function(e,i,r){return"request_retention"===i&&Number.isFinite(r)?t.intervalModifier=t.calculate_interval_modifier(Number(r)):"enable_short_term"===i?t.Scheduler=!0===r?et:it:"w"===i&&(r=Y(r,e.relearning_steps.length,e.enable_short_term),t.forgetting_curve=K.bind(this,r),t.intervalModifier=t.calculate_interval_modifier(Number(e.request_retention))),Reflect.set(e,i,r),!0}}}useStrategy(t,e){return this.strategyHandler.set(t,e),this}clearStrategy(t){return t?this.strategyHandler.delete(t):this.strategyHandler.clear(),this}getScheduler(t,e){return new(this.strategyHandler.get(A.SCHEDULER)||this.Scheduler)(t,e,this,this.strategyHandler)}repeat(t,e,i){const r=this.getScheduler(t,e).preview();return i&&"function"==typeof i?i(r):r}next(t,e,r,s){const a=this.getScheduler(t,e),n=c.rating(r);if(n===i.Manual)throw new Error("Cannot review a manual rating");const l=a.review(n);return s&&"function"==typeof s?s(l):l}get_retrievability(t,i,r=!0){const s=c.card(t);i=i?c.time(i):new Date;const a=s.state!==e.New?Math.max(_(i,s.last_review,"days"),0):0,n=s.state!==e.New?this.forgetting_curve(a,+s.stability.toFixed(8)):0;return r?`${(100*n).toFixed(2)}%`:n}rollback(t,r,s){const a=c.card(t),n=c.review_log(r);if(n.rating===i.Manual)throw new Error("Cannot rollback a manual rating");let l,o,d;switch(n.state){case e.New:l=n.due,o=void 0,d=0;break;case e.Learning:case e.Relearning:case e.Review:l=n.review,o=n.due,d=a.lapses-(n.rating===i.Again&&n.state===e.Review?1:0)}const h=wt(mt({},a),{due:l,stability:n.stability,difficulty:n.difficulty,elapsed_days:n.last_elapsed_days,scheduled_days:n.scheduled_days,reps:Math.max(0,a.reps-1),lapses:Math.max(0,d),learning_steps:n.learning_steps,state:n.state,last_review:o});return s&&"function"==typeof s?s(h):h}forget(t,r,s=!1,a){const n=c.card(t);r=c.time(r);const l=n.state===e.New?0:_(r,n.due,"days"),o={rating:i.Manual,state:n.state,due:n.due,stability:n.stability,difficulty:n.difficulty,elapsed_days:0,last_elapsed_days:n.elapsed_days,scheduled_days:l,learning_steps:n.learning_steps,review:r},d={card:wt(mt({},n),{due:r,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:s?0:n.reps,lapses:s?0:n.lapses,learning_steps:0,state:e.New,last_review:n.last_review}),log:o};return a&&"function"==typeof a?a(d):d}reschedule(t,e=[],r={}){const{recordLogHandler:s,reviewsOrderBy:a,skipManual:n=!0,now:l=new Date,update_memory_state:o=!1}=r;a&&"function"==typeof a&&e.sort(a),n&&(e=e.filter((t=>t.rating!==i.Manual)));const d=new ht(this),h=d.reschedule(r.first_card||B(),e),u=h.length,f=c.card(t),_=d.calculateManualRecord(f,l,u?h[u-1]:void 0,o);return s&&"function"==typeof s?{collections:h.map(s),reschedule_item:_?s(_):null}:{collections:h,reschedule_item:_}}}t.AbstractScheduler=O,t.BasicLearningStepsStrategy=R,t.CLAMP_PARAMETERS=q,t.ConvertStepUnitToMinutes=E,t.DefaultInitSeedStrategy=N,t.FSRS=bt,t.FSRS5_DEFAULT_DECAY=.5,t.FSRS6_DEFAULT_DECAY=z,t.FSRSAlgorithm=Q,t.FSRSVersion="v5.2.3 using FSRS-6.0",t.GenSeedStrategyWithCardId=function(t){return function(){var e;const i=null!=(e=Reflect.get(this.current,t))?e:0,r=this.current.reps;return String(i+r||0)}},t.Grades=v,t.INIT_S_MAX=G,t.Rating=i,t.S_MAX=36500,t.S_MIN=C,t.State=e,t.StrategyMode=A,t.TypeConvert=c,t.W17_W18_Ceiling=2,t.checkParameters=t=>{if(void 0!==t.find((t=>!Number.isFinite(t)&&!Number.isNaN(t))))throw Error(`Non-finite or NaN value in parameters ${t}`);if(![17,19,21].includes(t.length))throw Error(`Invalid parameter length: ${t.length}. Must be 17, 19 or 21 for FSRSv4, 5 and 6 respectively.`);return t},t.clamp=M,t.clipParameters=k,t.computeDecayFactor=J,t.createEmptyCard=B,t.dateDiffInDays=S,t.date_diff=_,t.date_scheduler=f,t.default_enable_fuzz=j,t.default_enable_short_term=H,t.default_learning_steps=P,t.default_maximum_interval=36500,t.default_relearning_steps=T,t.default_request_retention=.9,t.default_w=U,t.fixDate=function(t){return c.time(t)},t.fixRating=function(t){return c.rating(t)},t.fixState=function(t){return c.state(t)},t.forgetting_curve=K,t.formatDate=g,t.fsrs=t=>new bt(t||{}),t.generatorParameters=W,t.get_fuzz_range=x,t.migrateParameters=Y,t.show_diff_message=w}));
//# sourceMappingURL=/sm/15754b3891c0b13451c97034c2e2df21f91c39c19e7af3199965c14e161b884e.map